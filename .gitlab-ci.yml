image: maven:3.8.6-jdk-11
stages:
  - pull
  - build 
  - remove-d
  - build-image
pull-code:
  stage: pull
  only:
  - main
  tags:
  - java_deploy
  script:
  - echo "preparing data and dependencies..."
  - pwd
  - ls

build-code:
  stage: build
  only:
  - main
  tags:
  - java_deploy
  before_script:
  - echo "=======change permission ======="
  - chmod +x maveninstall.sh
  script:
  - echo "==== Project Building Started ====="
  - "./maveninstall.sh"
  - echo "code build Successfull..."
  - pwd
  when: on_success
  artifacts:
    paths:
    - .target/*.war
    expire_in: 15 days

# remove-old-docker:
#   stage: remove-d
#   only:
#   - main
#   tags:
#   - java_deploy
#   before_script:
#   - echo "change permission of dockerrmf.sh"
#   - chmod +x dockerrmf.sh
#   script:
#   - echo "Starting remove old docker image and container"
#   - "./dockerrmf.sh"
#   - echo "Removed all docker image and container"



build-docker-image:
  stage: build-image
  only:
  - main
  tags:
  - java_deploy
  needs:
  - build-code
  before_script:
  - chmod +x dockercmd.sh
  - echo "permission change"
  script:
  - "./dockercmd.sh"
  - echo "====Build And Deploy successfull.... ====="
